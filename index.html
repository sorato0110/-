<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>バンディット×ベイズ戦略</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      .animate-in { animation: animateIn 0.2s ease-out forwards; opacity: 0; }
      @keyframes animateIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
  </head>
  <body class="bg-slate-50 text-slate-800 font-sans antialiased selection:bg-indigo-100 selection:text-indigo-700">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript" data-type="module">
      import React, { useState, useEffect, useMemo, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        Trash2, Plus, RefreshCw, LayoutGrid, FlaskConical, TrendingUp, 
        Download, Upload, Info, ChevronDown, ChevronUp, CheckCircle2, 
        Clock, AlertCircle, Settings, X 
      } from 'lucide-react';

      // ==========================================
      // 1. DEFINITIONS & TYPES
      // ==========================================

      const ZoneType = {
        QUICK_WINS: 'QUICK_WINS',
        MAJOR_PROJECTS: 'MAJOR_PROJECTS',
        FILL_INS: 'FILL_INS',
        IGNORE: 'IGNORE',
      };

      // ==========================================
      // 2. CONSTANTS
      // ==========================================

      const STORAGE_KEY_ITEMS = 'ideaMatrix:v1:items';
      const STORAGE_KEY_FILTERS = 'ideaMatrix:v1:filters';
      const STORAGE_KEY_TITLE = 'ideaMatrix:v1:title';
      const STORAGE_KEY_HYPOTHESIS = 'hypothesisPracticeBoard:v1';
      const STORAGE_KEY_EXPERIMENTS = 'hypothesisAnalysisBoard:v1:experiments';
      const STORAGE_KEY_CONFIDENCE = 'hypothesisAnalysisBoard:v1:confidence';
      const STORAGE_KEY_KPI_CONFIG = 'hypothesisAnalysisBoard:v1:kpiConfig';

      const ZONES = {
        [ZoneType.QUICK_WINS]: {
          id: ZoneType.QUICK_WINS,
          label: '美味しい実験',
          color: 'text-emerald-700',
          bg: 'bg-emerald-50',
          border: 'border-emerald-200',
          activeClass: 'bg-emerald-600 text-white border-emerald-700 hover:bg-emerald-700'
        },
        [ZoneType.MAJOR_PROJECTS]: {
          id: ZoneType.MAJOR_PROJECTS,
          label: '大型案件',
          color: 'text-blue-700',
          bg: 'bg-blue-50',
          border: 'border-blue-200',
          activeClass: 'bg-blue-600 text-white border-blue-700 hover:bg-blue-700'
        },
        [ZoneType.FILL_INS]: {
          id: ZoneType.FILL_INS,
          label: '余裕があれば',
          color: 'text-amber-700',
          bg: 'bg-amber-50',
          border: 'border-amber-200',
          activeClass: 'bg-amber-500 text-white border-amber-600 hover:bg-amber-600'
        },
        [ZoneType.IGNORE]: {
          id: ZoneType.IGNORE,
          label: 'やらない候補',
          color: 'text-slate-600',
          bg: 'bg-slate-100',
          border: 'border-slate-200',
          activeClass: 'bg-slate-500 text-white border-slate-600 hover:bg-slate-600'
        },
      };

      const EFFORT_LABELS = {
        tiny: { label: 'とても小さい', color: 'bg-emerald-100 text-emerald-800' },
        small: { label: '小さい', color: 'bg-blue-100 text-blue-800' },
        normal: { label: 'ふつう', color: 'bg-yellow-100 text-yellow-800' },
        heavy: { label: '重め', color: 'bg-red-100 text-red-800' },
      };

      const STATUS_LABELS = {
        'not-started': { label: '未着手', color: 'bg-slate-100 text-slate-600' },
        'running': { label: '実行中', color: 'bg-indigo-100 text-indigo-700 animate-pulse' },
        'done': { label: '完了', color: 'bg-emerald-100 text-emerald-800' },
      };

      const PLATFORM_OPTIONS = [
        'X（旧Twitter）',
        'Instagram',
        'YouTube',
        'ブログ / note',
        'メルマガ',
        'フリマアプリ',
        '店舗POP / チラシ',
        'その他',
      ];

      const IMPACT_OPTIONS = {
        'plus-large': { label: 'かなりプラス (++20%)', color: 'text-emerald-600' },
        'plus-small': { label: '少しプラス (+5-10%)', color: 'text-teal-500' },
        'neutral': { label: 'ほぼ変わらない', color: 'text-slate-500' },
        'minus-small': { label: '少しマイナス (-5-10%)', color: 'text-amber-500' },
        'minus-large': { label: 'かなりマイナス (-20%)', color: 'text-rose-600' },
      };

      const DEFAULT_KPI_CONFIG = [
        { id: 'reach', label: 'リーチ(表示)', helper: 'どれくらいの人に届いたか' },
        { id: 'responses', label: '反応数', helper: 'いいね・コメント・クリックの合計など' },
        { id: 'sales', label: '売上/成約', helper: '購入や問い合わせなど、ゴールにつながる数' }
      ];

      // ==========================================
      // 3. STORAGE & HELPER FUNCTIONS
      // ==========================================

      const calculateMetrics = (impact, cost) => {
        const score = impact + (6 - cost);
        let zone;
        if (impact >= 3) {
          if (cost <= 2) zone = ZoneType.QUICK_WINS;
          else zone = ZoneType.MAJOR_PROJECTS;
        } else {
          if (cost <= 2) zone = ZoneType.FILL_INS;
          else zone = ZoneType.IGNORE;
        }
        return { score, zone };
      };

      const loadItems = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_ITEMS);
          return raw ? JSON.parse(raw) : [];
        } catch (e) { return []; }
      };
      const saveItems = (items) => localStorage.setItem(STORAGE_KEY_ITEMS, JSON.stringify(items));

      const loadFilters = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_FILTERS);
          return raw ? JSON.parse(raw) : {
            [ZoneType.QUICK_WINS]: true,
            [ZoneType.MAJOR_PROJECTS]: true,
            [ZoneType.FILL_INS]: true,
            [ZoneType.IGNORE]: true,
          };
        } catch (e) {
          return { [ZoneType.QUICK_WINS]: true, [ZoneType.MAJOR_PROJECTS]: true, [ZoneType.FILL_INS]: true, [ZoneType.IGNORE]: true };
        }
      };
      const saveFilters = (filters) => localStorage.setItem(STORAGE_KEY_FILTERS, JSON.stringify(filters));

      const loadTitle = () => localStorage.getItem(STORAGE_KEY_TITLE) || '';
      const saveTitle = (title) => localStorage.setItem(STORAGE_KEY_TITLE, title);

      const loadHypothesisItems = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_HYPOTHESIS);
          const parsed = raw ? JSON.parse(raw) : {};
          return parsed.items || [];
        } catch (e) { return []; }
      };
      const saveHypothesisItems = (items) => localStorage.setItem(STORAGE_KEY_HYPOTHESIS, JSON.stringify({ version: 1, items }));

      const loadExperiments = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_EXPERIMENTS);
          const parsed = raw ? JSON.parse(raw) : [];
          return Array.isArray(parsed) ? parsed : [];
        } catch (e) { return []; }
      };
      const saveExperiments = (items) => localStorage.setItem(STORAGE_KEY_EXPERIMENTS, JSON.stringify(items));

      const loadConfidenceData = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_CONFIDENCE);
          const parsed = raw ? JSON.parse(raw) : [];
          return Array.isArray(parsed) ? parsed : [];
        } catch (e) { return []; }
      };
      const saveConfidenceData = (items) => localStorage.setItem(STORAGE_KEY_CONFIDENCE, JSON.stringify(items));

      const loadKpiConfig = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY_KPI_CONFIG);
          const parsed = raw ? JSON.parse(raw) : DEFAULT_KPI_CONFIG;
          return Array.isArray(parsed) && parsed.length > 0 ? parsed : DEFAULT_KPI_CONFIG;
        } catch (e) { return DEFAULT_KPI_CONFIG; }
      };
      const saveKpiConfig = (config) => localStorage.setItem(STORAGE_KEY_KPI_CONFIG, JSON.stringify(config));

      // ==========================================
      // 4. SUB-COMPONENTS
      // ==========================================

      // --- IdeaMatrix ---
      const IdeaMatrix = ({ items, onItemClick }) => {
        const getPos = (val) => 10 + ((val - 1) * 20);
        return (
          <div className="w-full aspect-square max-w-lg mx-auto relative bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden select-none">
            <div className="absolute inset-0 grid grid-cols-2 grid-rows-2 opacity-30 pointer-events-none">
              <div className="bg-emerald-100 border-r border-b border-dashed border-slate-300"></div>
              <div className="bg-blue-100 border-b border-dashed border-slate-300"></div>
              <div className="bg-amber-100 border-r border-dashed border-slate-300"></div>
              <div className="bg-slate-100"></div>
            </div>
            <svg className="absolute inset-0 w-full h-full pointer-events-none" width="100%" height="100%">
              <text x="50%" y="98%" textAnchor="middle" className="text-[10px] fill-slate-400 uppercase tracking-widest">Cost (Low → High)</text>
              <text x="2%" y="50%" textAnchor="middle" transform="rotate(-90, 10, 50%)" className="text-[10px] fill-slate-400 uppercase tracking-widest" style={{ transformBox: 'fill-box' }}>Impact (Low → High)</text>
            </svg>
            <div className="absolute inset-4">
              {items.map((idea) => {
                const bottomPct = getPos(idea.impact);
                const leftPct = getPos(idea.cost);
                const zoneConfig = ZONES[idea.zone];
                // Fallback for safety
                if (!zoneConfig) return null;
                
                return (
                  <div
                    key={idea.id}
                    onClick={() => onItemClick?.(idea.id)}
                    className="absolute group cursor-pointer transition-all duration-300 hover:z-50"
                    style={{ bottom: `${bottomPct}%`, left: `${leftPct}%`, transform: 'translate(-50%, 50%)' }}
                  >
                    <div className={`w-4 h-4 rounded-full shadow-sm border-2 border-white ${zoneConfig.activeClass.split(' ')[0]} transition-transform group-hover:scale-125`}></div>
                    <div className="absolute left-1/2 -translate-x-1/2 bottom-full mb-1 min-w-[80px] w-max max-w-[120px] pointer-events-none z-10">
                      <div className={`px-2 py-1 text-[10px] font-medium rounded shadow-sm backdrop-blur-sm bg-white/90 border border-slate-200 text-center truncate opacity-0 group-hover:opacity-100 transition-opacity duration-200 md:opacity-100 md:bg-transparent md:border-0 md:shadow-none md:font-semibold md:text-slate-700 md:text-xs`}>
                        {idea.title}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        );
      };

      // --- IdeaList ---
      const IdeaList = ({ items, onDelete, highlightedId }) => {
        if (items.length === 0) return <div className="text-center py-8 text-slate-400 text-sm">表示するアイデアがありません。<br/>フォームから追加してください。</div>;
        return (
          <div className="space-y-3">
            {items.map((idea) => {
              const zoneConfig = ZONES[idea.zone];
              if (!zoneConfig) return null;
              const isHighlighted = highlightedId === idea.id;
              return (
                <div key={idea.id} id={`item-${idea.id}`} className={`relative flex items-start gap-3 p-4 rounded-lg border transition-all duration-300 ${isHighlighted ? 'ring-2 ring-indigo-400 bg-white shadow-md transform scale-[1.02]' : 'bg-white border-slate-200 shadow-sm hover:shadow-md'}`}>
                  <div className={`flex flex-col items-center justify-center w-10 h-10 rounded-full shrink-0 font-bold text-lg ${zoneConfig.bg} ${zoneConfig.color}`}>
                    {idea.score}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center justify-between gap-2 mb-1">
                      <h3 className="font-bold text-slate-800 truncate">{idea.title}</h3>
                      <span className={`text-[10px] px-2 py-0.5 rounded-full border font-medium whitespace-nowrap ${zoneConfig.bg} ${zoneConfig.color} ${zoneConfig.border}`}>{zoneConfig.label}</span>
                    </div>
                    {idea.memo && <p className="text-sm text-slate-600 mb-2 whitespace-pre-wrap break-words line-clamp-2">{idea.memo}</p>}
                    <div className="flex items-center gap-4 text-xs text-slate-400 font-mono mt-1">
                      <span>Impact: {idea.impact}</span>
                      <span>Cost: {idea.cost}</span>
                    </div>
                  </div>
                  <button onClick={(e) => { e.stopPropagation(); if(window.confirm(`「${idea.title}」を削除しますか？`)) onDelete(idea.id); }} className="text-slate-300 hover:text-rose-500 p-2 hover:bg-rose-50 rounded-full transition-colors">
                    <Trash2 size={16} />
                  </button>
                </div>
              );
            })}
          </div>
        );
      };

      // --- Hypothesis Components ---
      const HypothesisCard = ({ item, onUpdate, onDelete }) => {
        const isDone = item.status === 'done';
        const statusConfig = STATUS_LABELS[item.status];
        if (!statusConfig) return null;

        return (
          <div className={`bg-white rounded-xl shadow-sm border transition-all duration-300 overflow-hidden ${isDone ? 'border-slate-300 bg-slate-50' : 'border-slate-200 hover:shadow-md'}`}>
            <div className="px-4 py-3 bg-slate-50 border-b border-slate-100 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <select value={item.status} onChange={(e) => onUpdate(item.id, { status: e.target.value })} className={`text-sm font-bold px-3 py-1.5 rounded-full cursor-pointer border-transparent focus:ring-2 focus:ring-offset-1 outline-none appearance-none pr-8 relative z-10 ${statusConfig.color}`} style={{ backgroundImage: `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e")`, backgroundPosition: `right 0.5rem center`, backgroundSize: `1.5em 1.5em`, backgroundRepeat: 'no-repeat' }}>
                  <option value="not-started">未着手</option>
                  <option value="running">実行中</option>
                  <option value="done">完了</option>
                </select>
                {isDone && <CheckCircle2 size={18} className="text-emerald-600" />}
                {item.status === 'running' && <Clock size={18} className="text-indigo-500 animate-pulse" />}
              </div>
              <button onClick={() => onDelete(item.id)} className="text-slate-400 hover:text-rose-500 p-2 rounded-full hover:bg-rose-50 transition-colors">
                <Trash2 size={18} />
              </button>
            </div>
            <div className="p-5 grid grid-cols-1 md:grid-cols-12 gap-6">
              <div className="md:col-span-4 space-y-3">
                <div><label className="text-xs font-bold text-slate-400 uppercase">アイデア</label><h3 className="font-bold text-slate-800 leading-tight">{item.ideaTitle}</h3></div>
                <div><label className="text-xs font-bold text-slate-400 uppercase">仮説</label><p className="text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">{item.hypothesis}</p></div>
              </div>
              <div className="md:col-span-8 space-y-4">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div className="space-y-1">
                    <label className="text-xs font-bold text-slate-500">プラットフォーム</label>
                    <select value={item.platform} onChange={(e) => onUpdate(item.id, { platform: e.target.value })} className="w-full text-sm border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                      {PLATFORM_OPTIONS.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                    </select>
                    {item.platform === 'その他' && <input type="text" value={item.platformNote} onChange={(e) => onUpdate(item.id, { platformNote: e.target.value })} placeholder="詳細を入力" className="w-full text-sm border-slate-300 rounded-md mt-1 bg-white" />}
                  </div>
                  <div className="space-y-1"><label className="text-xs font-bold text-slate-500">テスト期間</label><input type="text" value={item.duration} onChange={(e) => onUpdate(item.id, { duration: e.target.value })} placeholder="例: 1週間" className="w-full text-sm border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 bg-white" /></div>
                  <div className="space-y-1"><label className="text-xs font-bold text-slate-500">作業量</label><select value={item.effort} onChange={(e) => onUpdate(item.id, { effort: e.target.value })} className={`w-full text-sm border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 font-medium bg-white ${EFFORT_LABELS[item.effort]?.color.split(' ')[1] || ''}`}><option value="tiny">とても小さい</option><option value="small">小さい</option><option value="normal">ふつう</option><option value="heavy">重め</option></select></div>
                  <div className="space-y-1"><label className="text-xs font-bold text-slate-500">成功指標 (KPI)</label><input type="text" value={item.kpi} onChange={(e) => onUpdate(item.id, { kpi: e.target.value })} placeholder="例: フォロワー+100" className="w-full text-sm border-slate-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 bg-white" /></div>
                </div>
                {isDone && (
                  <div className="bg-emerald-50 rounded-lg p-3 border border-emerald-100 animate-in">
                    <label className="text-xs font-bold text-emerald-700 mb-1 block flex items-center gap-1"><AlertCircle size={12} />学びメモ（結果・気づき）</label>
                    <textarea value={item.learning} onChange={(e) => onUpdate(item.id, { learning: e.target.value })} placeholder="実験の結果はどうでしたか？次に活かす学びを書きましょう。" rows={2} className="w-full text-sm bg-white border-emerald-200 rounded-md focus:ring-emerald-500 focus:border-emerald-500 placeholder:text-emerald-300" />
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      const HypothesisBoard = () => {
        const [items, setItems] = useState([]);
        const [inputIdea, setInputIdea] = useState('');
        const [inputHypothesis, setInputHypothesis] = useState('');
        const [sortOrder, setSortOrder] = useState('newest');
        const [statusFilter, setStatusFilter] = useState('all');

        useEffect(() => { setItems(loadHypothesisItems()); }, []);
        useEffect(() => { saveHypothesisItems(items); }, [items]);

        const handleAddItem = () => {
          if (!inputIdea.trim() || !inputHypothesis.trim()) return;
          const newItem = {
            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
            ideaTitle: inputIdea.trim(),
            hypothesis: inputHypothesis.trim(),
            platform: 'X（旧Twitter）',
            platformNote: '',
            duration: '',
            effort: 'normal',
            kpi: '',
            status: 'not-started',
            learning: '',
            createdAt: Date.now(),
          };
          setItems(prev => [newItem, ...prev]);
          setInputIdea('');
          setInputHypothesis('');
        };
        const handleUpdateItem = (id, updates) => setItems(prev => prev.map(item => item.id === id ? { ...item, ...updates } : item));
        const handleDeleteItem = (id) => { if (window.confirm('この仮説を削除してもよろしいですか？')) setItems(prev => prev.filter(item => item.id !== id)); };
        const handleResetAll = () => { if (window.confirm('本当にすべてのデータを削除しますか？')) { setItems([]); localStorage.removeItem(STORAGE_KEY_HYPOTHESIS); }};
        const filteredItems = useMemo(() => {
          let result = [...items];
          if (statusFilter !== 'all') result = result.filter(item => item.status === statusFilter);
          const effortOrder = ['tiny', 'small', 'normal', 'heavy'];
          if (sortOrder === 'effort') result.sort((a, b) => effortOrder.indexOf(a.effort) - effortOrder.indexOf(b.effort));
          else result.sort((a, b) => b.createdAt - a.createdAt);
          return result;
        }, [items, sortOrder, statusFilter]);

        return (
          <div className="space-y-8 pb-20">
            <section className="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
              <div className="mb-4 pb-2 border-b border-slate-100"><h2 className="text-lg font-bold text-slate-800 flex items-center gap-2"><span className="bg-indigo-600 text-white text-xs px-2 py-0.5 rounded-full">Step 1</span>アイデアから仮説をつくる</h2></div>
              <div className="space-y-4">
                <div><label className="block text-sm font-semibold text-slate-600 mb-1">アイデア名</label><input type="text" value={inputIdea} onChange={(e) => setInputIdea(e.target.value)} placeholder="例：AIで◯◯のコンテンツを配信" className="w-full px-4 py-2 bg-white text-slate-900 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none placeholder:text-slate-400" /></div>
                <div>
                  <label className="block text-sm font-semibold text-slate-600 mb-1">検証可能な仮説</label>
                  <div className="bg-indigo-50 p-3 rounded-lg mb-2 text-xs text-indigo-800 flex gap-2 items-start"><Info size={16} className="shrink-0 mt-0.5" /><ul className="list-disc list-inside space-y-0.5"><li>「もし○○すれば（行動）」</li><li>「いつまでに・どれくらい（期間・数値）」</li><li>「〜だろう（結果）」</li></ul></div>
                  <textarea value={inputHypothesis} onChange={(e) => setInputHypothesis(e.target.value)} placeholder={`例）\nもし、私が 〇〇 に関するAI生成コンテンツを SNS で毎日投稿すれば、\n1週間でフォロワーが 100 人増え、そのうち 5 人から有料サービスへの問い合わせが来るだろう。`} rows={4} className="w-full px-4 py-2 bg-white text-slate-900 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none resize-y placeholder:text-slate-400" />
                </div>
                <button onClick={handleAddItem} disabled={!inputIdea.trim() || !inputHypothesis.trim()} className="w-full bg-slate-800 hover:bg-slate-900 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold py-3 rounded-lg shadow transition-all flex items-center justify-center gap-2"><Plus size={20} />この仮説をリストに追加</button>
              </div>
            </section>
            <section className="space-y-4">
              <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2"><span className="bg-indigo-600 text-white text-xs px-2 py-0.5 rounded-full">Step 2 & 3</span>小さく試す計画ボード</h2>
                <div className="flex flex-wrap gap-2 text-sm">
                  <select value={sortOrder} onChange={(e) => setSortOrder(e.target.value)} className="px-3 py-1.5 border border-slate-300 rounded-lg bg-white text-slate-700"><option value="newest">追加順</option><option value="effort">作業量が小さい順</option></select>
                  <select value={statusFilter} onChange={(e) => setStatusFilter(e.target.value)} className="px-3 py-1.5 border border-slate-300 rounded-lg bg-white text-slate-700"><option value="all">すべて</option><option value="not-started">未着手</option><option value="running">実行中</option><option value="done">完了</option></select>
                  <button onClick={handleResetAll} className="px-3 py-1.5 border border-rose-200 text-rose-600 hover:bg-rose-50 rounded-lg transition-colors">すべて削除</button>
                </div>
              </div>
              <div className="space-y-4">
                {filteredItems.length === 0 ? <div className="text-center py-10 bg-slate-50 border border-dashed border-slate-300 rounded-xl text-slate-400">まだ仮説がありません。<br/>Step 1 から追加してください。</div> : filteredItems.map(item => <HypothesisCard key={item.id} item={item} onUpdate={handleUpdateItem} onDelete={handleDeleteItem} />)}
              </div>
            </section>
          </div>
        );
      };

      // --- Confidence Board Components ---
      const ExperimentCard = ({ experiment, kpiConfig, onUpdate, onDelete }) => {
        const [isOpen, setIsOpen] = useState(false);
        const responseRate = experiment.reach > 0 ? ((experiment.responses / experiment.reach) * 100).toFixed(1) : '-';
        const reachLabel = kpiConfig.find(k => k.id === 'reach')?.label || 'リーチ';
        const responsesLabel = kpiConfig.find(k => k.id === 'responses')?.label || '反応数';
        const salesLabel = kpiConfig.find(k => k.id === 'sales')?.label || '売上';

        return (
          <div className="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
            <div className="p-4 grid grid-cols-12 gap-4 items-center hover:bg-slate-50 transition-colors cursor-pointer" onClick={() => setIsOpen(!isOpen)}>
              <div className="col-span-12 md:col-span-4"><div className="text-xs font-bold text-slate-400">{experiment.period || '期間未設定'}</div><div className="font-bold text-slate-800 truncate">{experiment.ideaTitle}</div><div className="text-sm text-slate-600 truncate">{experiment.testTitle}</div></div>
              <div className="col-span-4 md:col-span-2 text-center"><div className="text-xs font-bold text-slate-400 truncate px-1" title={reachLabel}>{reachLabel}</div><div className="font-mono font-medium">{experiment.reach.toLocaleString()}</div></div>
              <div className="col-span-4 md:col-span-2 text-center"><div className="text-xs font-bold text-slate-400 truncate px-1" title={responsesLabel}>{responsesLabel}</div><div className="font-mono font-medium">{experiment.responses.toLocaleString()} <span className="text-xs text-slate-400">({responseRate}%)</span></div></div>
              <div className="col-span-4 md:col-span-2 text-center"><div className="text-xs font-bold text-slate-400 truncate px-1" title={salesLabel}>{salesLabel}</div><div className="font-mono font-bold text-emerald-600">¥{experiment.sales.toLocaleString()}</div></div>
              <div className="col-span-12 md:col-span-2 flex justify-end items-center gap-2"><button onClick={(e) => { e.stopPropagation(); onDelete(experiment.id); }} className="p-2 text-slate-300 hover:text-rose-500"><Trash2 size={16}/></button>{isOpen ? <ChevronUp size={20} className="text-slate-400"/> : <ChevronDown size={20} className="text-slate-400"/>}</div>
            </div>
            {isOpen && (
              <div className="border-t border-slate-100 bg-slate-50 p-4 space-y-4 animate-in">
                {experiment.memo && <div className="bg-white p-3 rounded border border-slate-200 text-sm text-slate-600"><span className="font-bold block text-xs text-slate-400 mb-1">MEMO</span>{experiment.memo}</div>}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div><label className="block text-xs font-bold text-emerald-700 mb-1">なぜうまくいったと思うか？（成功要因）</label><textarea value={experiment.successFactors} onChange={e => onUpdate(experiment.id, { successFactors: e.target.value })} className="w-full text-sm p-2 border border-emerald-200 bg-white rounded focus:ring-emerald-500 focus:border-emerald-500" rows={3} placeholder="要因を言語化..." /></div>
                  <div><label className="block text-xs font-bold text-rose-700 mb-1">うまくいかなかった点は？（課題）</label><textarea value={experiment.failureFactors} onChange={e => onUpdate(experiment.id, { failureFactors: e.target.value })} className="w-full text-sm p-2 border border-rose-200 bg-white rounded focus:ring-rose-500 focus:border-rose-500" rows={3} placeholder="課題を言語化..." /></div>
                </div>
                <div><label className="block text-xs font-bold text-indigo-700 mb-1 flex items-center gap-1">ユーザーの声 / フィードバック<span className="text-[10px] font-normal text-slate-500 ml-1">(数字にならない声をメモ)</span></label><textarea value={experiment.feedback} onChange={e => onUpdate(experiment.id, { feedback: e.target.value })} className="w-full text-sm p-2 border border-indigo-200 bg-white rounded focus:ring-indigo-500 focus:border-indigo-500" rows={2} placeholder="感想、コメント、アンケート結果など..." /></div>
              </div>
            )}
          </div>
        );
      };

      const ConfidenceTracker = ({ data, onUpdate }) => {
        const [tempConfidence, setTempConfidence] = useState(data.currentConfidence);
        const handleSliderChange = (e) => setTempConfidence(Number(e.target.value));
        const handleSliderCommit = () => onUpdate(data.ideaTitle, { currentConfidence: tempConfidence });
        useEffect(() => { setTempConfidence(data.currentConfidence); }, [data.currentConfidence]);
        
        const impactConfig = IMPACT_OPTIONS[data.lastImpact];

        return (
          <div className="bg-white border border-slate-200 rounded-lg p-5 shadow-sm">
            <h3 className="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2"><TrendingUp size={20} className="text-indigo-600"/>{data.ideaTitle}</h3>
            <div className="grid grid-cols-1 md:grid-cols-12 gap-6 items-start">
              <div className="md:col-span-3 space-y-2">
                <label className="text-xs font-bold text-slate-400">前回までの自信度</label>
                <div className="text-3xl font-bold text-slate-700">{tempConfidence}%</div>
                <input type="range" min="0" max="100" value={tempConfidence} onChange={handleSliderChange} onMouseUp={handleSliderCommit} onTouchEnd={handleSliderCommit} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" />
              </div>
              <div className="md:col-span-4 space-y-2">
                <label className="text-xs font-bold text-slate-400">今回の実験の影響</label>
                <div className="space-y-2">
                  <select value={data.lastImpact} onChange={(e) => onUpdate(data.ideaTitle, { lastImpact: e.target.value })} className={`w-full p-2 border rounded-md text-sm font-bold bg-white ${impactConfig?.color || ''}`}>
                    {Object.entries(IMPACT_OPTIONS).map(([key, opt]) => <option key={key} value={key}>{opt.label}</option>)}
                  </select>
                  <p className="text-xs text-slate-500">※これを選んでから、左のスライダーを動かして自信度を更新してください。</p>
                </div>
              </div>
              <div className="md:col-span-5 space-y-2">
                <label className="text-xs font-bold text-slate-400">メモ（なぜそう更新したか？）</label>
                <textarea value={data.memo} onChange={e => onUpdate(data.ideaTitle, { memo: e.target.value })} className="w-full p-2 text-sm border border-slate-300 rounded-md focus:ring-indigo-500 outline-none" rows={3} placeholder="どのデータ/コメントが効いたか..." />
              </div>
            </div>
          </div>
        );
      };

      const ConfidenceBoard = () => {
        const [experiments, setExperiments] = useState([]);
        const [confidenceData, setConfidenceData] = useState([]);
        const [kpiConfig, setKpiConfig] = useState(DEFAULT_KPI_CONFIG);
        const [ideaTitle, setIdeaTitle] = useState('');
        const [testTitle, setTestTitle] = useState('');
        const [period, setPeriod] = useState('');
        const [reach, setReach] = useState('');
        const [responses, setResponses] = useState('');
        const [sales, setSales] = useState('');
        const [memo, setMemo] = useState('');
        const [filterIdea, setFilterIdea] = useState('all');
        const [sortOrder, setSortOrder] = useState('newest');
        const [isKpiModalOpen, setIsKpiModalOpen] = useState(false);
        const [editingKpiConfig, setEditingKpiConfig] = useState([]);

        useEffect(() => { setExperiments(loadExperiments()); setConfidenceData(loadConfidenceData()); setKpiConfig(loadKpiConfig()); }, []);
        useEffect(() => { saveExperiments(experiments); }, [experiments]);
        useEffect(() => { saveConfidenceData(confidenceData); }, [confidenceData]);
        useEffect(() => {
          const uniqueIdeas = Array.from(new Set(experiments.map(e => e.ideaTitle)));
          setConfidenceData(prev => {
            const currentMap = new Map(prev.map(c => [c.ideaTitle, c]));
            let hasChanges = false;
            uniqueIdeas.forEach(idea => {
              if (!currentMap.has(idea)) {
                currentMap.set(idea, { ideaTitle: idea, currentConfidence: 50, lastImpact: 'neutral', memo: '', updatedAt: Date.now() });
                hasChanges = true;
              }
            });
            return hasChanges ? Array.from(currentMap.values()) : prev;
          });
        }, [experiments]);

        const handleAddExperiment = () => {
          if (!ideaTitle.trim() || !testTitle.trim()) return;
          const newExp = {
            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
            ideaTitle: ideaTitle.trim(), testTitle: testTitle.trim(), period: period.trim(),
            reach: Number(reach) || 0, responses: Number(responses) || 0, sales: Number(sales) || 0,
            memo: memo.trim(), successFactors: '', failureFactors: '', feedback: '', createdAt: Date.now(),
          };
          setExperiments(prev => [newExp, ...prev]);
          setIdeaTitle(''); setTestTitle(''); setPeriod(''); setReach(''); setResponses(''); setSales(''); setMemo('');
        };
        const handleUpdateExperiment = (id, updates) => setExperiments(prev => prev.map(exp => exp.id === id ? { ...exp, ...updates } : exp));
        const handleDeleteExperiment = (id) => { if (window.confirm('この実験記録を削除しますか？')) setExperiments(prev => prev.filter(e => e.id !== id)); };
        const handleUpdateConfidence = (ideaTitle, updates) => setConfidenceData(prev => prev.map(c => c.ideaTitle === ideaTitle ? { ...c, ...updates, updatedAt: Date.now() } : c));
        const openKpiModal = () => { setEditingKpiConfig(JSON.parse(JSON.stringify(kpiConfig))); setIsKpiModalOpen(true); };
        const closeKpiModal = () => setIsKpiModalOpen(false);
        const saveKpiModal = () => { setKpiConfig(editingKpiConfig); saveKpiConfig(editingKpiConfig); setIsKpiModalOpen(false); };
        const handleKpiEditChange = (index, field, value) => { const newConfig = [...editingKpiConfig]; newConfig[index][field] = value; setEditingKpiConfig(newConfig); };
        const getKpiInputProps = (id) => {
          switch(id) { case 'reach': return { value: reach, setValue: setReach }; case 'responses': return { value: responses, setValue: setResponses }; case 'sales': return { value: sales, setValue: setSales }; default: return { value: '', setValue: () => {} }; }
        };

        const filteredExperiments = useMemo(() => {
          let result = [...experiments];
          if (filterIdea !== 'all') result = result.filter(e => e.ideaTitle === filterIdea);
          if (sortOrder === 'sales') result.sort((a, b) => b.sales - a.sales);
          else if (sortOrder === 'response_rate') result.sort((a, b) => { const rateA = a.reach > 0 ? a.responses / a.reach : 0; const rateB = b.reach > 0 ? b.responses / b.reach : 0; return rateB - rateA; });
          else result.sort((a, b) => b.createdAt - a.createdAt);
          return result;
        }, [experiments, filterIdea, sortOrder]);
        const uniqueIdeaTitles = useMemo(() => Array.from(new Set(experiments.map(e => e.ideaTitle))), [experiments]);

        return (
          <div className="space-y-10 pb-20 relative">
            {isKpiModalOpen && (
              <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in">
                <div className="bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden">
                  <div className="p-4 border-b border-slate-100 flex items-center justify-between"><h3 className="font-bold text-slate-800 flex items-center gap-2"><Settings size={18} className="text-slate-500" />指標ラベルのカスタマイズ</h3><button onClick={closeKpiModal} className="text-slate-400 hover:text-slate-600"><X size={20} /></button></div>
                  <div className="p-6 space-y-6">
                    {editingKpiConfig.map((item, index) => (
                      <div key={item.id} className="space-y-2">
                        <div className="text-xs font-bold text-slate-400 uppercase tracking-wider">{item.id}</div>
                        <div className="grid grid-cols-1 gap-2">
                          <input type="text" value={item.label} onChange={(e) => handleKpiEditChange(index, 'label', e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md text-sm font-bold text-slate-700 focus:ring-2 focus:ring-indigo-500 bg-white" placeholder="ラベル名" />
                          <input type="text" value={item.helper} onChange={(e) => handleKpiEditChange(index, 'helper', e.target.value)} className="w-full px-3 py-2 border border-slate-300 rounded-md text-sm text-slate-500 bg-slate-50 focus:ring-2 focus:ring-indigo-500" placeholder="説明文" />
                        </div>
                      </div>
                    ))}
                  </div>
                  <div className="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3"><button onClick={closeKpiModal} className="px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-200 rounded-lg transition-colors">キャンセル</button><button onClick={saveKpiModal} className="px-4 py-2 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors shadow-sm">保存する</button></div>
                </div>
              </div>
            )}
            <section className="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
              <div className="mb-4 pb-2 border-b border-slate-100"><h2 className="text-lg font-bold text-slate-800 flex items-center gap-2"><span className="bg-indigo-600 text-white text-xs px-2 py-0.5 rounded-full">Step 1</span>実験結果を記録する</h2></div>
              <div className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div><label className="block text-xs font-bold text-slate-500 mb-1">アイデア名</label><input type="text" value={ideaTitle} onChange={e => setIdeaTitle(e.target.value)} placeholder="例：AIで◯◯解説のショート動画" className="w-full px-3 py-2 bg-white border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 outline-none text-sm" /></div>
                  <div><label className="block text-xs font-bold text-slate-500 mb-1">テスト名 / 実験名</label><input type="text" value={testTitle} onChange={e => setTestTitle(e.target.value)} placeholder="例：1週間毎日投稿テスト" className="w-full px-3 py-2 bg-white border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 outline-none text-sm" /></div>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <div className="md:col-span-1"><label className="block text-xs font-bold text-slate-500 mb-1">実施期間</label><input type="text" value={period} onChange={e => setPeriod(e.target.value)} placeholder="例：3日間" className="w-full px-3 py-2 bg-white border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 outline-none text-sm" /></div>
                  <div className="md:col-span-3 relative bg-slate-50 p-3 rounded-lg border border-slate-100">
                    <button onClick={openKpiModal} className="absolute top-2 right-2 text-xs flex items-center gap-1 text-slate-400 hover:text-indigo-600 transition-colors bg-white px-2 py-1 rounded border border-slate-200 shadow-sm"><Settings size={12} />指標を編集</button>
                    <div className="grid grid-cols-3 gap-3">
                      {kpiConfig.map((kpi) => {
                        const { value, setValue } = getKpiInputProps(kpi.id);
                        return (
                          <div key={kpi.id}>
                            <label className="block text-xs font-bold text-slate-600 mb-1 truncate" title={kpi.label}>{kpi.label}</label>
                            <input type="number" value={value} onChange={e => setValue(e.target.value)} className="w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="0" />
                            <div className="text-[10px] text-slate-400 mt-1 truncate leading-tight" title={kpi.helper}>{kpi.helper}</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>
                <div><label className="block text-xs font-bold text-slate-500 mb-1">メモ（結果の概要）</label><textarea value={memo} onChange={e => setMemo(e.target.value)} placeholder="例：フォロワーは増えたが、DMは0件だった" rows={2} className="w-full px-3 py-2 bg-white border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 outline-none text-sm" /></div>
                <button onClick={handleAddExperiment} disabled={!ideaTitle.trim() || !testTitle.trim()} className="w-full bg-slate-800 hover:bg-slate-900 disabled:bg-slate-300 text-white font-bold py-2.5 rounded-lg shadow flex items-center justify-center gap-2 transition-all"><Plus size={18} />この実験結果を追加</button>
              </div>
            </section>
            <section className="space-y-4">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2"><span className="bg-indigo-600 text-white text-xs px-2 py-0.5 rounded-full">Step 2</span>データから学びを言語化する</h2>
                <div className="flex flex-wrap gap-2 text-sm">
                  <select value={filterIdea} onChange={e => setFilterIdea(e.target.value)} className="px-2 py-1.5 border border-slate-300 rounded bg-white text-slate-700 max-w-[140px] truncate"><option value="all">すべてのアイデア</option>{uniqueIdeaTitles.map(t => <option key={t} value={t}>{t}</option>)}</select>
                  <select value={sortOrder} onChange={e => setSortOrder(e.target.value)} className="px-2 py-1.5 border border-slate-300 rounded bg-white text-slate-700"><option value="newest">新しい順</option><option value="sales">売上が高い順</option><option value="response_rate">反応率が高い順</option></select>
                </div>
              </div>
              <div className="space-y-4">
                {filteredExperiments.length === 0 ? <div className="text-center py-8 text-slate-400 bg-slate-50 border border-dashed border-slate-300 rounded-lg">実験ログがありません。</div> : filteredExperiments.map(exp => <ExperimentCard key={exp.id} experiment={exp} kpiConfig={kpiConfig} onUpdate={handleUpdateExperiment} onDelete={handleDeleteExperiment} />)}
              </div>
            </section>
            <section className="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
              <div className="mb-4 pb-2 border-b border-slate-100"><h2 className="text-lg font-bold text-slate-800 flex items-center gap-2 mb-2"><span className="bg-indigo-600 text-white text-xs px-2 py-0.5 rounded-full">Step 3</span>仮説の自信度をアップデートする</h2><p className="text-xs text-slate-500 leading-relaxed">小さな実験で得られたデータやフィードバックをもとに、「このアイデアがうまくいく確率」を自分なりに更新していきましょう。<br/>これはベイズ更新の “ざっくりバージョン” です。</p></div>
              <div className="space-y-6">
                {confidenceData.length === 0 ? <div className="text-center py-6 text-slate-400">実験を追加すると、ここに自信度トラッカーが表示されます。</div> : confidenceData.map(conf => <ConfidenceTracker key={conf.ideaTitle} data={conf} onUpdate={handleUpdateConfidence} />)}
              </div>
            </section>
          </div>
        );
      };

      // ==========================================
      // 5. MAIN APP
      // ==========================================

      const App = () => {
        const [currentView, setCurrentView] = useState('matrix');
        const [items, setItems] = useState([]);
        const [filters, setFilters] = useState({
          [ZoneType.QUICK_WINS]: true,
          [ZoneType.MAJOR_PROJECTS]: true,
          [ZoneType.FILL_INS]: true,
          [ZoneType.IGNORE]: true,
        });
        const [projectTitle, setProjectTitle] = useState('');
        const [highlightedId, setHighlightedId] = useState(null);
        
        const [title, setTitle] = useState('');
        const [memo, setMemo] = useState('');
        const [impact, setImpact] = useState(3);
        const [cost, setCost] = useState(3);

        useEffect(() => {
          setItems(loadItems());
          setFilters(loadFilters());
          setProjectTitle(loadTitle());
        }, []);

        useEffect(() => { saveItems(items); }, [items]);
        useEffect(() => { saveFilters(filters); }, [filters]);
        useEffect(() => { saveTitle(projectTitle); }, [projectTitle]);
        useEffect(() => { if (highlightedId) { const timer = setTimeout(() => setHighlightedId(null), 2000); return () => clearTimeout(timer); } }, [highlightedId]);

        const handleAddIdea = (e) => {
          e.preventDefault();
          if (!title.trim()) return;
          const { score, zone } = calculateMetrics(impact, cost);
          const newIdea = {
            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
            title: title.trim(), memo: memo.trim(), impact, cost, score, zone, createdAt: Date.now(),
          };
          setItems(prev => [...prev, newIdea]);
          setTitle(''); setMemo(''); setImpact(3); setCost(3);
        };

        const handleDelete = (id) => setItems(prev => prev.filter(item => item.id !== id));
        const handleReset = () => { if (window.confirm('本当にすべてのデータを削除しますか？この操作は取り消せません。')) { setItems([]); localStorage.removeItem(STORAGE_KEY_ITEMS); }};
        const toggleFilter = (zone) => setFilters(prev => ({ ...prev, [zone]: !prev[zone] }));

        const handleExport = () => {
          const exportData = { items, title: projectTitle };
          const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportData));
          const downloadAnchorNode = document.createElement('a');
          downloadAnchorNode.setAttribute("href", dataStr);
          downloadAnchorNode.setAttribute("download", "ideas_backup.json");
          document.body.appendChild(downloadAnchorNode);
          downloadAnchorNode.click();
          downloadAnchorNode.remove();
        };

        const fileInputRef = useRef(null);
        const handleImportClick = () => fileInputRef.current?.click();
        const handleImportFile = (e) => {
          const file = e.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const json = JSON.parse(event.target?.result);
              if (window.confirm('現在のデータを上書きしてインポートしますか？')) {
                if (Array.isArray(json)) setItems(json);
                else if (json.items && Array.isArray(json.items)) {
                  setItems(json.items);
                  if (json.title) setProjectTitle(json.title);
                }
              }
            } catch (err) { alert('ファイルの読み込みに失敗しました'); }
          };
          reader.readAsText(file);
          e.target.value = '';
        };

        const handleChartItemClick = (id) => {
          setHighlightedId(id);
          const el = document.getElementById(`item-${id}`);
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

        const filteredItems = useMemo(() => {
          return items
            .filter(item => filters[item.zone])
            .sort((a, b) => b.score - a.score || b.createdAt - a.createdAt);
        }, [items, filters]);

        return (
          <div className="min-h-screen bg-slate-50 pb-20 md:pb-8">
            <header className="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200">
              <div className="max-w-4xl mx-auto px-4 pt-3 pb-2">
                <div className="flex items-center justify-between mb-4">
                  <h1 className="text-lg font-bold text-slate-700 hidden sm:block">バンディット×ベイズ戦略</h1>
                  <h1 className="text-lg font-bold text-slate-700 sm:hidden">戦略ボード</h1>
                  
                  <div className="flex p-1 bg-slate-100 rounded-lg overflow-x-auto no-scrollbar">
                    <button onClick={() => setCurrentView('matrix')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap ${currentView === 'matrix' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><LayoutGrid size={16} />戦略マップ</button>
                    <button onClick={() => setCurrentView('hypothesis')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap ${currentView === 'hypothesis' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><FlaskConical size={16} />仮説検証</button>
                    <button onClick={() => setCurrentView('confidence')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium transition-all whitespace-nowrap ${currentView === 'confidence' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><TrendingUp size={16} />自信度分析</button>
                  </div>
                </div>

                {currentView === 'matrix' && (
                  <div className="flex flex-col sm:flex-row gap-3 justify-between items-start sm:items-center">
                    <div className="flex flex-wrap gap-2">
                      {Object.values(ZONES).map((zone) => (
                        <button key={zone.id} onClick={() => toggleFilter(zone.id)} className={`px-3 py-1.5 rounded-full text-xs font-semibold transition-all border ${filters[zone.id] ? zone.activeClass : 'bg-white text-slate-400 border-slate-200 hover:border-slate-300'}`}>{zone.label}</button>
                      ))}
                    </div>
                    <div className="flex gap-2 self-end sm:self-auto">
                      <button onClick={handleExport} title="Export JSON" className="p-2 text-slate-500 hover:text-indigo-600 hover:bg-slate-100 rounded-full transition-colors"><Download size={18} /></button>
                      <button onClick={handleImportClick} title="Import JSON" className="p-2 text-slate-500 hover:text-indigo-600 hover:bg-slate-100 rounded-full transition-colors"><Upload size={18} /></button>
                      <input type="file" ref={fileInputRef} onChange={handleImportFile} className="hidden" accept=".json" />
                      <button onClick={handleReset} title="Reset All" className="p-2 text-slate-500 hover:text-rose-600 hover:bg-slate-100 rounded-full transition-colors"><RefreshCw size={18} /></button>
                    </div>
                  </div>
                )}
              </div>
            </header>

            <main className="max-w-4xl mx-auto px-4 pt-6 space-y-8">
              {currentView === 'matrix' && (
                <>
                  <section className="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
                    <form onSubmit={handleAddIdea} className="space-y-4">
                      <div><input type="text" placeholder="タイトル (例: 新機能LP作成)" value={title} onChange={e => setTitle(e.target.value)} className="w-full px-4 py-2 text-gray-900 font-medium placeholder:text-slate-500 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all" required /></div>
                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-xs font-semibold text-slate-600 uppercase tracking-wider mb-2">Impact (効果)</label>
                          <div className="flex justify-between bg-slate-100 rounded-lg p-1">
                            {[1, 2, 3, 4, 5].map((v) => <button key={v} type="button" onClick={() => setImpact(v)} className={`w-8 h-8 rounded-md text-sm font-bold transition-all ${impact === v ? 'bg-white text-indigo-600 shadow-sm ring-1 ring-black/5' : 'text-slate-600 hover:text-slate-800'}`}>{v}</button>)}
                          </div>
                        </div>
                        <div>
                          <label className="block text-xs font-semibold text-slate-600 uppercase tracking-wider mb-2">Cost (工数)</label>
                          <div className="flex justify-between bg-slate-100 rounded-lg p-1">
                            {[1, 2, 3, 4, 5].map((v) => <button key={v} type="button" onClick={() => setCost(v)} className={`w-8 h-8 rounded-md text-sm font-bold transition-all ${cost === v ? 'bg-white text-rose-500 shadow-sm ring-1 ring-black/5' : 'text-slate-600 hover:text-slate-800'}`}>{v}</button>)}
                          </div>
                        </div>
                      </div>
                      <div><textarea placeholder="メモ (任意)" value={memo} onChange={e => setMemo(e.target.value)} rows={2} className="w-full px-4 py-2 text-gray-900 font-medium placeholder:text-slate-500 bg-white rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all resize-none" /></div>
                      <button type="submit" className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-md hover:shadow-lg transition-all active:scale-[0.99]">保存する</button>
                    </form>
                  </section>
                  <section>
                    <div className="flex items-center justify-between mb-2"><input type="text" value={projectTitle} onChange={(e) => setProjectTitle(e.target.value)} placeholder="マップのタイトルを入力..." className="w-full font-bold text-slate-700 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-indigo-500 focus:ring-0 focus:outline-none transition-all p-0 text-lg placeholder:text-slate-300" /></div>
                    <IdeaMatrix items={filteredItems} onItemClick={handleChartItemClick} />
                  </section>
                  <section>
                    <div className="flex items-center justify-between mb-4"><h2 className="font-bold text-slate-700">優先度順リスト</h2><span className="text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded-full border border-slate-200">{filteredItems.length} items</span></div>
                    <IdeaList items={filteredItems} onDelete={handleDelete} highlightedId={highlightedId} />
                  </section>
                </>
              )}
              {currentView === 'hypothesis' && <HypothesisBoard />}
              {currentView === 'confidence' && <ConfidenceBoard />}
            </main>
            {currentView === 'matrix' && (
              <div className="md:hidden fixed bottom-6 right-6 z-50">
                <button onClick={() => { window.scrollTo({ top: 0, behavior: 'smooth' }); }} className="bg-indigo-600 text-white p-4 rounded-full shadow-lg hover:bg-indigo-700 transition-colors"><Plus size={24} /></button>
              </div>
            )}
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>